local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Player Lock-On",
    LoadingTitle = "Lock-On Script",
    LoadingSubtitle = "for your game",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MyGameLockOn",
        FileName = "Config"
    }
})

local Tab = Window:CreateTab("Combat", 4483362458) -- Tab title and icon

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera

local LocalPlayer = Players.LocalPlayer

local LockEnabled = false
local HoldingKey = false
local Connection

-- Simple function to find the closest player (you can add team check, alive check, etc.)
local function GetClosestPlayer()
    local closestPlayer = nil
    local closestDistance = math.huge
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local distance = (head.Position - Camera.CFrame.Position).Magnitude
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = player
            end
        end
    end
    
    return closestPlayer
end

-- The lock-on loop
local function StartLockOn()
    if Connection then return end
    
    Connection = RunService.RenderStepped:Connect(function()
        if HoldingKey and LockEnabled then
            local targetPlayer = GetClosestPlayer()
            if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("Head") then
                local targetPos = targetPlayer.Character.Head.Position
                Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPos)
            end
        end
    end)
end

local function StopLockOn()
    if Connection then
        Connection:Disconnect()
        Connection = nil
    end
end

-- Rayfield Toggle to enable/disable the feature
Tab:CreateToggle({
    Name = "Enable Player Lock-On",
    CurrentValue = false,
    Callback = function(Value)
        LockEnabled = Value
        if not Value then
            StopLockOn()
            HoldingKey = false
        end
    end
})

-- Rayfield Keybind (this is the button you HOLD)
Tab:CreateKeybind({
    Name = "Hold to Lock On",
    CurrentKeybind = "Q", -- Change this to whatever key you prefer
    HoldToActivate = true, -- IMPORTANT: This makes it activate only while holding
    Callback = function(Keybind)
        HoldingKey = true
        if LockEnabled then
            StartLockOn()
        end
    end,
    ReleasedCallback = function(Keybind) -- This fires when you release the key
        HoldingKey = false
        -- No need to stop connection here since it checks HoldingKey every frame
    end
})

Rayfield:Notify({
    Title = "Lock-On Loaded",
    Content = "Toggle the feature on, then hold the keybind to lock the camera onto the closest player.",
    Duration = 8
})
